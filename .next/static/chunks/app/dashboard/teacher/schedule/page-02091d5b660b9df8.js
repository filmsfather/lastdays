(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7644],{3019:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(5155),a=s(2115),l=s(2663),n=s(2619),i=s.n(n);function c(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)([]),[c,o]=(0,a.useState)(!1),[d,x]=(0,a.useState)(new Date),[m,h]=(0,a.useState)({amStart:"10:00",amEnd:"15:50",pmStart:"16:00",pmEnd:"21:50",intervalMinutes:10});(0,a.useEffect)(()=>{!async function(){try{let e=await fetch("/api/auth/me",{credentials:"include"}),s=await e.json();if(s.success){if(t(s.user),"teacher"!==s.user.role){l.oR.error("교사만 접근 가능한 페이지입니다."),window.location.href="/login";}}else{window.location.href="/login";}}catch(e){console.error("사용자 정보 조회 실패:",e),window.location.href="/login"}}()},[]);let u=e=>{let t=new Date(e),s=t.getDay(),r=t.getDate()-s+(0===s?-6:1);return new Date(t.setDate(r))};(0,a.useEffect)(()=>{x(u(new Date))},[]);let g=async(t,s)=>{if(!e)return void l.oR.error("사용자 정보를 불러오는 중입니다.");let r={date:t,teacherId:e.id.toString(),amStart:m.amStart,amEnd:m.amEnd,pmStart:m.pmStart,pmEnd:m.pmEnd,intervalMinutes:m.intervalMinutes,sessionOnly:s};try{let e=await fetch("/api/teacher/slots/create-timeslots",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json();t.success?(l.oR.success("".concat("AM"===s?"오전":"오후"," 슬롯이 생성되었습니다.")),b()):l.oR.error(t.error||"슬롯 생성에 실패했습니다.")}catch(e){console.error("슬롯 생성 실패:",e),l.oR.error("슬롯 생성 중 오류가 발생했습니다.")}},p=async e=>{if(!e.is_available&&e.current_reservations>0)return void l.oR.error("예약이 있는 슬롯은 쉬는시간으로 설정할 수 없습니다.");try{let t=await fetch("/api/teacher/slots/manage-timeslots",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e.date,timeSlot:e.time_slot,teacherId:e.teacher_id,isBreak:e.is_available})}),s=await t.json();s.success?(l.oR.success(s.message),b()):l.oR.error(s.error||"설정 변경에 실패했습니다.")}catch(e){console.error("쉬는시간 설정 실패:",e),l.oR.error("설정 변경 중 오류가 발생했습니다.")}},b=async()=>{if(!e)return void n([]);o(!0);try{let t=[];for(let s=0;s<7;s++){let r=new Date(d);r.setDate(d.getDate()+s);let a=r.toISOString().split("T")[0],l=fetch("/api/teacher/slots?date=".concat(a,"&teacherId=").concat(e.id)).then(e=>e.json()).then(e=>e.success?e.slots:[]);t.push(l)}let s=(await Promise.all(t)).flat();n(s)}catch(e){console.error("주간 타임슬롯 조회 실패:",e),l.oR.error("타임슬롯 조회에 실패했습니다.")}finally{o(!1)}};return((0,a.useEffect)(()=>{e&&b()},[e,d]),e)?(0,r.jsxs)("div",{className:"min-h-screen gradient-bg",children:[(0,r.jsx)("nav",{className:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-40",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-green-600 rounded-xl flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-bold text-sm",children:"T"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{className:"text-lg font-bold text-gray-900",children:[e.name," 선생님"]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"내 스케줄 관리"})]})]}),(0,r.jsx)(i(),{href:"/dashboard/teacher",className:"btn-ghost",children:"← 교사 대시보드"})]})})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"내 스케줄 관리"}),(0,r.jsx)("p",{className:"text-xl text-gray-600",children:"나만의 수업 시간을 생성하고 쉬는시간을 설정하세요"})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"주간 스케줄"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"간격 설정"}),(0,r.jsxs)("select",{value:m.intervalMinutes,onChange:e=>h(t=>({...t,intervalMinutes:parseInt(e.target.value)})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:10,children:"10분 간격"}),(0,r.jsx)("option",{value:15,children:"15분 간격"}),(0,r.jsx)("option",{value:20,children:"20분 간격"}),(0,r.jsx)("option",{value:30,children:"30분 간격"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시간대 설정"}),(0,r.jsxs)("div",{className:"flex space-x-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"오전:"}),(0,r.jsx)("input",{type:"time",value:m.amStart,onChange:e=>h(t=>({...t,amStart:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"}),(0,r.jsx)("span",{children:"-"}),(0,r.jsx)("input",{type:"time",value:m.amEnd,onChange:e=>h(t=>({...t,amEnd:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"오후:"}),(0,r.jsx)("input",{type:"time",value:m.pmStart,onChange:e=>h(t=>({...t,pmStart:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"}),(0,r.jsx)("span",{children:"-"}),(0,r.jsx)("input",{type:"time",value:m.pmEnd,onChange:e=>h(t=>({...t,pmEnd:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6 p-4 bg-gray-50 rounded-xl",children:[(0,r.jsxs)("button",{onClick:()=>{let e=new Date(d);e.setDate(e.getDate()-7),x(e)},className:"flex items-center px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-white rounded-lg transition-colors",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"이전 주"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[d.getFullYear(),"년 ",d.getMonth()+1,"월 ",d.getDate(),"일 주간"]}),(0,r.jsx)("button",{onClick:()=>{x(u(new Date))},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"이번 주"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=new Date(d);e.setDate(e.getDate()+7),x(e)},className:"flex items-center px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-white rounded-lg transition-colors",children:["다음 주",(0,r.jsx)("svg",{className:"w-5 h-5 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["월","화","수","목","금","토","일"].map(e=>(0,r.jsx)("div",{className:"text-center p-2 text-sm font-medium text-gray-500 bg-gray-50 rounded-lg",children:e},e))}),c?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"로딩 중..."})]}):(0,r.jsx)("div",{className:"grid grid-cols-7 gap-1",children:(e=>{let t=[];for(let s=0;s<7;s++){let r=new Date(e);r.setDate(e.getDate()+s),t.push(r)}return t})(d).map((e,t)=>{let a=(e=>{let t=e.toISOString().split("T")[0],r=s.filter(e=>e.date===t);return{AM:r.filter(e=>"AM"===e.session_period).sort((e,t)=>e.time_slot.localeCompare(t.time_slot)),PM:r.filter(e=>"PM"===e.session_period).sort((e,t)=>e.time_slot.localeCompare(t.time_slot))}})(e),l=e.toDateString()===new Date().toDateString(),n=e<new Date&&!l,i=e.toISOString().split("T")[0];return(0,r.jsxs)("div",{className:"min-h-96 p-2 border rounded-lg ".concat(n?"bg-gray-50 opacity-50":"bg-white"," ").concat(l?"border-blue-300 bg-blue-50":"border-gray-200"),children:[(0,r.jsx)("div",{className:"text-sm font-medium mb-3 text-center ".concat(l?"text-blue-700":"text-gray-700"),children:(e=>{let t=e.getMonth()+1,s=e.getDate(),r=["일","월","화","수","목","금","토"][e.getDay()];return"".concat(t,"/").concat(s," (").concat(r,")")})(e)}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-orange-600",children:"오전"}),(0,r.jsx)("button",{onClick:()=>g(i,"AM"),className:"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded hover:bg-orange-200 transition-colors",children:"+ 생성"})]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:0===a.AM.length?(0,r.jsx)("div",{className:"text-xs text-gray-400 text-center py-2",children:"슬롯 없음"}):a.AM.map(e=>(0,r.jsxs)("div",{className:"p-1 rounded text-xs ".concat(e.is_available?e.current_reservations>0?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800":"bg-gray-200 text-gray-600"),children:[(0,r.jsx)("div",{className:"font-medium",children:e.time_slot}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsxs)("span",{children:[e.current_reservations,"/",e.max_capacity]}),(0,r.jsx)("div",{className:"flex space-x-1",children:(0,r.jsx)("button",{onClick:()=>p(e),className:"w-4 h-4 rounded text-xs flex items-center justify-center ".concat(e.is_available?"bg-yellow-300 hover:bg-yellow-400":"bg-green-300 hover:bg-green-400"),title:e.is_available?"쉬는시간 설정":"예약 가능 설정",children:e.is_available?"⏸":"▶"})})]}),!e.is_available&&(0,r.jsx)("div",{className:"text-red-600 text-xs mt-1",children:"쉬는시간"})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-purple-600",children:"오후"}),(0,r.jsx)("button",{onClick:()=>g(i,"PM"),className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200 transition-colors",children:"+ 생성"})]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:0===a.PM.length?(0,r.jsx)("div",{className:"text-xs text-gray-400 text-center py-2",children:"슬롯 없음"}):a.PM.map(e=>(0,r.jsxs)("div",{className:"p-1 rounded text-xs ".concat(e.is_available?e.current_reservations>0?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800":"bg-gray-200 text-gray-600"),children:[(0,r.jsx)("div",{className:"font-medium",children:e.time_slot}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsxs)("span",{children:[e.current_reservations,"/",e.max_capacity]}),(0,r.jsx)("div",{className:"flex space-x-1",children:(0,r.jsx)("button",{onClick:()=>p(e),className:"w-4 h-4 rounded text-xs flex items-center justify-center ".concat(e.is_available?"bg-yellow-300 hover:bg-yellow-400":"bg-green-300 hover:bg-green-400"),title:e.is_available?"쉬는시간 설정":"예약 가능 설정",children:e.is_available?"⏸":"▶"})})]}),!e.is_available&&(0,r.jsx)("div",{className:"text-red-600 text-xs mt-1",children:"쉬는시간"})]},e.id))})]})]},t)})})]}),(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mt-6",children:[(0,r.jsx)("h4",{className:"font-medium text-green-800 mb-2",children:"사용 안내"}),(0,r.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"+ 생성"}),": 해당 날짜의 오전/오후 전체 시간대에 타임슬롯을 자동으로 생성합니다"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"⏸ 버튼"}),": 예약 가능한 슬롯을 쉬는시간으로 변경합니다 (하루 최대 8개)"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"▶ 버튼"}),": 쉬는시간을 다시 예약 가능한 상태로 변경합니다"]}),(0,r.jsx)("p",{children:"• 예약이 있는 슬롯은 쉬는시간으로 변경할 수 없습니다"})]})]})]})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"사용자 정보를 불러오는 중..."})]})})}},4884:(e,t,s)=>{Promise.resolve().then(s.bind(s,3019))}},e=>{e.O(0,[2619,2663,8441,1255,7358],()=>e(e.s=4884)),_N_E=e.O()}]);