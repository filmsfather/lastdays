(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4477],{5519:(e,t,s)=>{Promise.resolve().then(s.bind(s,5596))},5596:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(5155),a=s(2115),n=s(2663),l=s(2619),i=s.n(l);function c(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)([]),[c,o]=(0,a.useState)(""),[d,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)(new Date),[h,g]=(0,a.useState)({show:!1,date:"",sessionPeriod:"AM"}),[b,p]=(0,a.useState)({amStart:"10:00",amEnd:"15:50",pmStart:"16:00",pmEnd:"21:50",intervalMinutes:10}),v=e=>{let t=new Date(e),s=t.getDay(),r=t.getDate()-s+(0===s?-6:1);return new Date(t.setDate(r))};(0,a.useEffect)(()=>{j(),u(v(new Date))},[]);let j=async()=>{try{let e=await fetch("/api/admin/accounts?role=teacher"),s=await e.json();s.success&&t(s.accounts)}catch(e){console.error("교사 목록 조회 실패:",e),n.oR.error("교사 목록 조회에 실패했습니다.")}},y=async(e,t)=>{if(!c)return void n.oR.error("교사를 먼저 선택해주세요.");let s={date:e,teacherId:c,amStart:b.amStart,amEnd:b.amEnd,pmStart:b.pmStart,pmEnd:b.pmEnd,intervalMinutes:b.intervalMinutes,sessionOnly:t};try{let e=await fetch("/api/admin/slots/create-timeslots",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await e.json();r.success?(n.oR.success("".concat("AM"===t?"오전":"오후"," 슬롯이 생성되었습니다.")),w(c),g({show:!1,date:"",sessionPeriod:"AM"})):n.oR.error(r.error||"슬롯 생성에 실패했습니다.")}catch(e){console.error("슬롯 생성 실패:",e),n.oR.error("슬롯 생성 중 오류가 발생했습니다.")}},f=async e=>{if(e.current_reservations>0)return void n.oR.error("예약이 있는 슬롯은 삭제할 수 없습니다.");if(confirm("".concat(e.time_slot," 슬롯을 삭제하시겠습니까?")))try{let t=await fetch("/api/admin/slots/manage-timeslots?date=".concat(e.date,"&time_slot=").concat(e.time_slot,"&teacher_id=").concat(e.teacher_id),{method:"DELETE"}),s=await t.json();s.success?(n.oR.success("타임슬롯이 삭제되었습니다."),c&&w(c)):n.oR.error(s.error||"삭제에 실패했습니다.")}catch(e){console.error("타임슬롯 삭제 실패:",e),n.oR.error("삭제 중 오류가 발생했습니다.")}},N=async e=>{if(!e.is_available&&e.current_reservations>0)return void n.oR.error("예약이 있는 슬롯은 쉬는시간으로 설정할 수 없습니다.");try{let t=await fetch("/api/admin/slots/manage-timeslots",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e.date,timeSlot:e.time_slot,teacherId:e.teacher_id,isBreak:e.is_available})}),s=await t.json();s.success?(n.oR.success(s.message),c&&w(c)):n.oR.error(s.error||"설정 변경에 실패했습니다.")}catch(e){console.error("쉬는시간 설정 실패:",e),n.oR.error("설정 변경 중 오류가 발생했습니다.")}},w=async e=>{if(!e)return void l([]);x(!0);try{let t=new Date(m);t.setDate(t.getDate()+6);let s=[];for(let t=0;t<7;t++){let r=new Date(m);r.setDate(m.getDate()+t);let a=r.toISOString().split("T")[0],n=fetch("/api/admin/slots?date=".concat(a,"&teacherId=").concat(e)).then(e=>e.json()).then(e=>e.success?e.slots:[]);s.push(n)}let r=(await Promise.all(s)).flat();l(r)}catch(e){console.error("주간 타임슬롯 조회 실패:",e),n.oR.error("타임슬롯 조회에 실패했습니다.")}finally{x(!1)}};return(0,a.useEffect)(()=>{c&&w(c)},[c,m]),s.reduce((e,t)=>{let s=t.session_period;return e[s]||(e[s]=[]),e[s].push(t),e},{}),(0,r.jsxs)("div",{className:"min-h-screen gradient-bg",children:[(0,r.jsx)("nav",{className:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-40",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-red-600 rounded-xl flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-bold text-sm",children:"A"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"Last Days Admin"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"타임슬롯 관리"})]})]}),(0,r.jsx)(i(),{href:"/dashboard/admin",className:"btn-ghost",children:"← 관리자 대시보드"})]})})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"타임슬롯 관리"}),(0,r.jsx)("p",{className:"text-xl text-gray-600",children:"10분 단위 예약 타임슬롯을 생성하고 관리하세요"})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"주간 타임슬롯 관리"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"교사 선택"}),(0,r.jsxs)("select",{value:c,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"교사를 선택하세요"}),e.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.class_name,")"]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"간격 설정"}),(0,r.jsxs)("select",{value:b.intervalMinutes,onChange:e=>p(t=>({...t,intervalMinutes:parseInt(e.target.value)})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:10,children:"10분 간격"}),(0,r.jsx)("option",{value:15,children:"15분 간격"}),(0,r.jsx)("option",{value:20,children:"20분 간격"}),(0,r.jsx)("option",{value:30,children:"30분 간격"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시간대 설정"}),(0,r.jsxs)("div",{className:"flex space-x-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"오전:"}),(0,r.jsx)("input",{type:"time",value:b.amStart,onChange:e=>p(t=>({...t,amStart:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"}),(0,r.jsx)("span",{children:"-"}),(0,r.jsx)("input",{type:"time",value:b.amEnd,onChange:e=>p(t=>({...t,amEnd:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"오후:"}),(0,r.jsx)("input",{type:"time",value:b.pmStart,onChange:e=>p(t=>({...t,pmStart:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"}),(0,r.jsx)("span",{children:"-"}),(0,r.jsx)("input",{type:"time",value:b.pmEnd,onChange:e=>p(t=>({...t,pmEnd:e.target.value})),className:"w-16 px-1 py-1 border border-gray-300 rounded text-xs"})]})]})]})]}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6 p-4 bg-gray-50 rounded-xl",children:[(0,r.jsxs)("button",{onClick:()=>{let e=new Date(m);e.setDate(e.getDate()-7),u(e)},className:"flex items-center px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-white rounded-lg transition-colors",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"이전 주"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[m.getFullYear(),"년 ",m.getMonth()+1,"월 ",m.getDate(),"일 주간"]}),(0,r.jsx)("button",{onClick:()=>{u(v(new Date))},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"이번 주"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=new Date(m);e.setDate(e.getDate()+7),u(e)},className:"flex items-center px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-white rounded-lg transition-colors",children:["다음 주",(0,r.jsx)("svg",{className:"w-5 h-5 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["월","화","수","목","금","토","일"].map(e=>(0,r.jsx)("div",{className:"text-center p-2 text-sm font-medium text-gray-500 bg-gray-50 rounded-lg",children:e},e))}),d?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"로딩 중..."})]}):(0,r.jsx)("div",{className:"grid grid-cols-7 gap-1",children:(e=>{let t=[];for(let s=0;s<7;s++){let r=new Date(e);r.setDate(e.getDate()+s),t.push(r)}return t})(m).map((e,t)=>{let a=(e=>{let t=e.toISOString().split("T")[0],r=s.filter(e=>e.date===t);return{AM:r.filter(e=>"AM"===e.session_period).sort((e,t)=>e.time_slot.localeCompare(t.time_slot)),PM:r.filter(e=>"PM"===e.session_period).sort((e,t)=>e.time_slot.localeCompare(t.time_slot))}})(e),n=e.toDateString()===new Date().toDateString(),l=e<new Date&&!n,i=e.toISOString().split("T")[0];return(0,r.jsxs)("div",{className:"min-h-96 p-2 border rounded-lg ".concat(l?"bg-gray-50 opacity-50":"bg-white"," ").concat(n?"border-blue-300 bg-blue-50":"border-gray-200"),children:[(0,r.jsx)("div",{className:"text-sm font-medium mb-3 text-center ".concat(n?"text-blue-700":"text-gray-700"),children:(e=>{let t=e.getMonth()+1,s=e.getDate(),r=["일","월","화","수","목","금","토"][e.getDay()];return"".concat(t,"/").concat(s," (").concat(r,")")})(e)}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-orange-600",children:"오전"}),(0,r.jsx)("button",{onClick:()=>y(i,"AM"),className:"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded hover:bg-orange-200 transition-colors",children:"+ 생성"})]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:0===a.AM.length?(0,r.jsx)("div",{className:"text-xs text-gray-400 text-center py-2",children:"슬롯 없음"}):a.AM.map(e=>(0,r.jsxs)("div",{className:"p-1 rounded text-xs ".concat(e.is_available?e.current_reservations>0?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800":"bg-gray-200 text-gray-600"),children:[(0,r.jsx)("div",{className:"font-medium",children:e.time_slot}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsxs)("span",{children:[e.current_reservations,"/",e.max_capacity]}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("button",{onClick:()=>N(e),className:"w-4 h-4 rounded text-xs flex items-center justify-center ".concat(e.is_available?"bg-yellow-300 hover:bg-yellow-400":"bg-green-300 hover:bg-green-400"),title:e.is_available?"쉬는시간 설정":"예약 가능 설정",children:e.is_available?"⏸":"▶"}),(0,r.jsx)("button",{onClick:()=>f(e),disabled:e.current_reservations>0,className:"w-4 h-4 rounded text-xs flex items-center justify-center ".concat(e.current_reservations>0?"bg-gray-300 cursor-not-allowed":"bg-red-300 hover:bg-red-400"),title:"슬롯 삭제",children:"\xd7"})]})]}),!e.is_available&&(0,r.jsx)("div",{className:"text-red-600 text-xs mt-1",children:"쉬는시간"})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-purple-600",children:"오후"}),(0,r.jsx)("button",{onClick:()=>y(i,"PM"),className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200 transition-colors",children:"+ 생성"})]}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:0===a.PM.length?(0,r.jsx)("div",{className:"text-xs text-gray-400 text-center py-2",children:"슬롯 없음"}):a.PM.map(e=>(0,r.jsxs)("div",{className:"p-1 rounded text-xs ".concat(e.is_available?e.current_reservations>0?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800":"bg-gray-200 text-gray-600"),children:[(0,r.jsx)("div",{className:"font-medium",children:e.time_slot}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsxs)("span",{children:[e.current_reservations,"/",e.max_capacity]}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("button",{onClick:()=>N(e),className:"w-4 h-4 rounded text-xs flex items-center justify-center ".concat(e.is_available?"bg-yellow-300 hover:bg-yellow-400":"bg-green-300 hover:bg-green-400"),title:e.is_available?"쉬는시간 설정":"예약 가능 설정",children:e.is_available?"⏸":"▶"}),(0,r.jsx)("button",{onClick:()=>f(e),disabled:e.current_reservations>0,className:"w-4 h-4 rounded text-xs flex items-center justify-center ".concat(e.current_reservations>0?"bg-gray-300 cursor-not-allowed":"bg-red-300 hover:bg-red-400"),title:"슬롯 삭제",children:"\xd7"})]})]}),!e.is_available&&(0,r.jsx)("div",{className:"text-red-600 text-xs mt-1",children:"쉬는시간"})]},e.id))})]})]},t)})})]})]})]})]})}}},e=>{e.O(0,[2619,2663,8441,1255,7358],()=>e(e.s=5519)),_N_E=e.O()}]);